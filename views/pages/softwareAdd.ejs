<% include ../includes/backend-head.ejs %>
<body style="overflow-x: hidden;background-color: #eee;">
<% include ../includes/backend-header.ejs %>
<div class="main">
    <% include ../includes/backend-sidebar.ejs %>
    <div class="backend-container">
        <div class="row pb-10" style="margin-right: 0;margin-left: 0">
            <h2 class="w100 tc"><%= software && software._id ? "软件更新" : "软件添加" %></h2>
        </div>
        <hr class="layui-bg-blue pt-5">
        <div class="backend-content" style="background-color: #fff">
            <div class="layui-form" style="padding: 0 15px">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <input type="hidden" value="<%= software && software._id %>" class="layui-input"
                               id="software_id">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_name">软件名称</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.name %>"
                               placeholder="请输入软件名称"
                               autocomplete="on" class="layui-input" id="software_name">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_version">软件版本</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.version %>"
                               placeholder="请输入软件版本"
                               autocomplete="on" class="layui-input" id="software_version">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_environment">硬件环境</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.environment %>"
                               placeholder="请输入硬件环境"
                               autocomplete="on" class="layui-input" id="software_environment">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_lang">软件语言</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.lang %>"
                               placeholder="请输入软件语言"
                               autocomplete="on" class="layui-input" id="software_lang">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_system">操作系统</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.system %>"
                               placeholder="请输入软件支持的操作系统"
                               autocomplete="on" class="layui-input" id="software_system">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_system">百度云下载地址</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.baiduyunUrl %>"
                               placeholder="请输入软件百度云地址"
                               autocomplete="on" class="layui-input" id="software_baiduyunUrl">
                    </div>
                </div>
				<div class="layui-form-item">
					<label class="layui-form-label" for="software_system">软件封面地址</label>
					<div class="layui-input-block">
						<input type="text" value="<%= software && software.figure %>"
							   placeholder="请输入软件图片地址"
							   autocomplete="on" class="layui-input" id="software_figure">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label" for="software_system">软件下载地址</label>
					<div class="layui-input-block">
						<input type="text" value="<%= software && software.linkUrl %>"
							   placeholder="请输入软件下载地址"
							   autocomplete="on" class="layui-input" id="software_linkUrl">
					</div>
				</div>

                <!--<div class="layui-form-item">-->
                    <!--<label class="layui-form-label" for="software_figure">上传图片</label>-->
                    <!--<button type="button" class="layui-btn" id="software_figure">-->
                        <!--<i class="layui-icon">&#xe67c;</i>点击上传-->
                    <!--</button>-->
                    <!--<span style="margin-left: 10px">-->
                        <!--<a id="software_figure_desc" href="" style='color:#469ff8;'-->
                           <!--target='_blank'>-->
                            <!---->
                        <!--</a>-->
                    <!--</span>-->
                <!--</div>-->

                <!--<div class="layui-form-item mt-30">-->
                    <!--<label class="layui-form-label" for="software_linkUrl">上传软件</label>-->
                    <!--<button type="button" class="layui-btn" id="software_linkUrl">-->
                        <!--<i class="layui-icon">&#xe67c;</i>点击上传-->
                    <!--</button>-->
                    <!--<span style="margin-left: 10px">-->
                        <!--<a id="software_linkUrl_desc" href="" style='color:#469ff8;'-->
                           <!--target='_blank'>-->
                            <!---->
                        <!--</a>-->
                    <!--</span>-->
                    <!--&lt;!&ndash;<div id="uploadFileProgress" style="display: none" class="layui-progress layui-progress mt-15"&ndash;&gt;-->
                    <!--&lt;!&ndash;lay-showpercent="true" lay-filter="upload-progress">&ndash;&gt;-->
                    <!--&lt;!&ndash;<div class="layui-progress-bar layui-bg-blue" lay-percent="0%"></div>&ndash;&gt;-->
                    <!--&lt;!&ndash;</div>&ndash;&gt;-->
                <!--</div>-->

                <div class="layui-form-item mt-30 pb-30">
                    <div class="layui-input-block">
                        <button class="layui-btn" type="button" id="save_software">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	$(document).ready(function () {
		layer.config({
			title: '提示'
		})

		$("#save_software").bind('click', function () {
			var software_id = $('#software_id').val();
			var software_name = $('#software_name').val();
			var software_version = $('#software_version').val();
			var software_environment = $('#software_environment').val();
			var software_lang = $('#software_lang').val();
			var software_system = $('#software_system').val();
			var software_baiduyunUrl = $("#software_baiduyunUrl").val();
			var software_figure = $('#software_figure').val();
			var software_linkUrl = $('#software_linkUrl').val();
			if (!(software_name.trim() && software_version.trim() && software_environment.trim() && software_lang.trim() && software_system.trim())) {
				layer.msg("软件信息不能为空哦😯!");
				return;
			}
			if (!software_baiduyunUrl.trim()) {
				layer.msg("软件百度云地址未填写!")
				return;
			}
			if (!software_figure.trim()) {
				layer.msg("软件封面图片未填写!")
				return;
			}
			if (!software_linkUrl.trim()) {
				layer.msg('软件下载地址未填写!')
				return;
			}

			$.ajax({
				type: 'POST',
				url: '/admin/software/save',
				data: {
					softwareId: software_id,
					name: software_name,
					version: software_version,
					environment: software_environment,
					lang: software_lang,
					system: software_system,
					figure: software_figure,
					linkUrl: software_linkUrl,
					baiduyunUrl: software_baiduyunUrl
				}
			}).done(function (res) {
				if (res.success === 1) {
					layer.msg("软件信息保存成功!")
					location.replace('/admin/softwareList')
				}
			})

		})

//		layui.use('upload', function () {
//			var upload = layui.upload;
//			var index1, index2;
//
//			//执行实例
//			var uploadInst1 = upload.render({
//				elem: '#software_figure',
//				url: '/admin/software/image/upload', //上传接口
//				accept: 'images',
//				choose: function () {
//					index1 = layer.load(1);
//				},
//				done: function (res) {
//					//上传完毕回调
//					if (res.code === 0) {
//						layer.close(index1);
//						var ele = $("#software_figure_desc");
//						ele.text(res.data.src);
//						ele.attr('href', res.data.src);
//						layer.msg("图片上传成功")
//					} else {
//						layer.msg(res.msg)
//					}
//				},
//				error: function () {
//					//请求异常回调
//					layer.msg('上传失败，请检查网络!')
//				}
//			});
//
//			//执行实例
//			var uploadInst2 = upload.render({
//				elem: '#software_linkUrl', //绑定元素
//				url: '/admin/software/file/upload', //上传接口
//				accept: 'file',
//				choose: function () {
//					index2 = layer.load(2);
//				},
//				done: function (res) {
//					//上传完毕回调
//					if (res.code === 0) {
//						layer.close(index2);
//						var ele = $("#software_linkUrl_desc");
//						ele.text(res.data.src);
//						ele.attr('href', res.data.src);
//						layer.msg("软件上传成功")
//					} else {
//						layer.msg(res.msg)
//					}
//				},
//				error: function () {
//					//请求异常回调
//					layer.msg('上传失败，请检查网络!')
//				}
//			});
//		});
	})
</script>
</body>