<% include ../includes/backend-head.ejs %>
<body style="overflow-x: hidden;background-color: #eee;">
<% include ../includes/backend-header.ejs %>
<div class="main">
    <% include ../includes/backend-sidebar.ejs %>
    <div class="backend-container">
        <div class="row pb-10" style="margin-right: 0;margin-left: 0">
            <h2 class="w100 tc"><%= software && software._id ? "è½¯ä»¶æ›´æ–°" : "è½¯ä»¶æ·»åŠ " %></h2>
        </div>
        <hr class="layui-bg-blue pt-5">
        <div class="backend-content" style="background-color: #fff">
            <div class="layui-form" style="padding: 0 15px">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <input type="hidden" value="<%= software && software._id %>" class="layui-input"
                               id="software_id">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_name">è½¯ä»¶åç§°</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.name %>"
                               placeholder="è¯·è¾“å…¥è½¯ä»¶åç§°"
                               autocomplete="on" class="layui-input" id="software_name">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_version">è½¯ä»¶ç‰ˆæœ¬</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.version %>"
                               placeholder="è¯·è¾“å…¥è½¯ä»¶ç‰ˆæœ¬"
                               autocomplete="on" class="layui-input" id="software_version">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_environment">ç¡¬ä»¶ç¯å¢ƒ</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.environment %>"
                               placeholder="è¯·è¾“å…¥ç¡¬ä»¶ç¯å¢ƒ"
                               autocomplete="on" class="layui-input" id="software_environment">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_lang">è½¯ä»¶è¯­è¨€</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.lang %>"
                               placeholder="è¯·è¾“å…¥è½¯ä»¶è¯­è¨€"
                               autocomplete="on" class="layui-input" id="software_lang">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_system">æ“ä½œç³»ç»Ÿ</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= software && software.system %>"
                               placeholder="è¯·è¾“å…¥è½¯ä»¶æ”¯æŒçš„æ“ä½œç³»ç»Ÿ"
                               autocomplete="on" class="layui-input" id="software_system">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_figure">ä¸Šä¼ å›¾ç‰‡</label>
                    <button type="button" class="layui-btn" id="software_figure">
                        <i class="layui-icon">&#xe67c;</i>ç‚¹å‡»ä¸Šä¼ 
                    </button>
                    <span style="margin-left: 10px">
                        <a id="software_figure_desc" href="<%= software && software.figure %>" style='color:#469ff8;'
                           target='_blank'>
                            <%= software && software.figure %>
                        </a>
                    </span>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="software_linkUrl">ä¸Šä¼ è½¯ä»¶</label>
                    <button type="button" class="layui-btn" id="software_linkUrl">
                        <i class="layui-icon">&#xe67c;</i>ç‚¹å‡»ä¸Šä¼ 
                    </button>
                    <span style="margin-left: 10px">
                        <a id="software_linkUrl_desc" href="<%= software && software.linkUrl %>" style='color:#469ff8;'
                           target='_blank'>
                            <%= software && software.linkUrl %>
                        </a>
                    </span>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" type="button" id="save_software">ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	$(document).ready(function () {
		layer.config({
			title: 'æç¤º'
		})

		$("#save_software").bind('click', function () {
			var software_id = $('#software_id').val();
			var software_name = $('#software_name').val();
			var software_version = $('#software_version').val();
			var software_environment = $('#software_environment').val();
			var software_lang = $('#software_lang').val();
			var software_system = $('#software_system').val();
			var software_figure = $('#software_figure_desc').text();
			console.log(software_figure, software_figure.length ,typeof software_figure, software_figure.trim());
			var software_linkUrl = $('#software_linkUrl_desc').text();
			if (!(software_name && software_version && software_environment && software_lang && software_system)) {
				layer.msg("è½¯ä»¶ä¿¡æ¯ä¸èƒ½ä¸ºç©ºå“¦ğŸ˜¯!");
				return;
			}
			if (!software_figure.trim()) {
				layer.msg("è½¯ä»¶å›¾ç‰‡æœªä¸Šä¼ !")
				return;
			}
			if (!software_linkUrl.trim()) {
				layer.msg('è½¯ä»¶æœªä¸Šä¼ !')
				return;
			}

			$.ajax({
				type: 'POST',
				url: '/admin/software/save',
				data: {
					softwareId: software_id,
					name: software_name,
					version: software_version,
					environment: software_environment,
					lang: software_lang,
					system: software_system,
					figure: software_figure,
					linkUrl: software_linkUrl
				}
			}).done(function (res) {
				if (res.success === 1) {
					layer.msg("è½¯ä»¶ä¿¡æ¯ä¿å­˜æˆåŠŸ!")
					location.replace('/admin/softwareList')
				}
			})

		})

		layui.use('upload', function () {
			var upload = layui.upload;

			//æ‰§è¡Œå®ä¾‹
			var uploadInst1 = upload.render({
				elem: '#software_figure',
				url: '/admin/software/image/upload', //ä¸Šä¼ æ¥å£
				accept: 'images',
				done: function (res) {
					//ä¸Šä¼ å®Œæ¯•å›è°ƒ
					if (res.code === 0) {
						var ele = $("#software_figure_desc");
						ele.text(res.data.src);
						ele.attr('href', res.data.src);
					} else {
						layer.msg(res.msg)
					}
				},
				error: function () {
					//è¯·æ±‚å¼‚å¸¸å›è°ƒ
					layer.msg('ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ!')
				}
			});

			//æ‰§è¡Œå®ä¾‹
			var uploadInst2 = upload.render({
				elem: '#software_linkUrl', //ç»‘å®šå…ƒç´ 
				url: '/admin/software/file/upload', //ä¸Šä¼ æ¥å£
				accept: 'file',
				done: function (res) {
					//ä¸Šä¼ å®Œæ¯•å›è°ƒ
					if (res.code === 0) {
						var ele = $("#software_linkUrl_desc");
						ele.text(res.data.src);
						ele.attr('href', res.data.src);
					} else {
						layer.msg(res.msg)
					}
				},
				error: function () {
					//è¯·æ±‚å¼‚å¸¸å›è°ƒ
					layer.msg('ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ!')
				}
			});
		});
	})
</script>
</body>