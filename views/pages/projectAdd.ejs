<% include ../includes/backend-head.ejs %>
<body style="overflow-x: hidden;background-color: #eee;">
<% include ../includes/backend-header.ejs %>
<div class="main">
    <% include ../includes/backend-sidebar.ejs %>
    <div class="backend-container">
        <div class="row pb-10" style="margin-right: 0;margin-left: 0">
            <h2 class="w100 tc"><%= project && project._id ? "äº§å“æ¡ˆä¾‹æ›´æ–°" : "äº§å“æ¡ˆä¾‹æ·»åŠ " %></h2>
        </div>
        <hr class="layui-bg-blue pt-5">
        <div class="backend-content" style="background-color: #fff">
            <div class="layui-form" style="padding: 0 15px">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <input type="hidden" value="<%= project && project._id %>" class="layui-input"
                               id="project_id">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" for="project_title">äº§å“æ¡ˆä¾‹åç§°</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= project && project.title %>"
                               placeholder="è¯·è¾“å…¥äº§å“æ¡ˆä¾‹åç§°"
                               autocomplete="on" class="layui-input" id="project_title">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">äº§å“æ¡ˆä¾‹ç±»å‹</label>
                    <div class="layui-input-block">
                        <% projectCategorys.forEach(function (projectCategory, index) { %>
                        <% if (project && (projectCategory._id.toString() === project.category.toString())) { %>
                        <input type="radio" name="project_category" value="<%= projectCategory._id %>"
                               title="<%= projectCategory.name %>" checked>
                        <% } else { %>
                        <input type="radio" name="project_category" value="<%= projectCategory._id %>"
                               title="<%= projectCategory.name %>">
                        <% } %>
                        <% }) %>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" for="project_imgUrl">äº§å“æ¡ˆä¾‹å›¾ç‰‡åœ°å€</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= project && project.imgUrl %>"
                               placeholder="è¯·è¾“å…¥äº§å“æ¡ˆä¾‹å›¾ç‰‡çš„åœ°å€"
                               autocomplete="on" class="layui-input" id="project_imgUrl">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" for="project_company">æ¡ˆä¾‹é¡¹ç›®å…¬å¸</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= project && project.company %>"
                               placeholder="è¯·è¾“å…¥åº”ç”¨è¯¥æ¡ˆä¾‹é¡¹ç›®çš„å…¬å¸"
                               autocomplete="on" class="layui-input" id="project_company">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" for="project_linkUrl">æ¡ˆä¾‹é¡¹ç›®é“¾æ¥</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= project && project.linkUrl %>"
                               placeholder="è¯·è¾“å…¥åº”ç”¨è¯¥æ¡ˆä¾‹é¡¹ç›®çš„é“¾æ¥"
                               autocomplete="on" class="layui-input" id="project_linkUrl">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" for="project_comment">æ¡ˆä¾‹è¯„ä»·</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= project && project.comment %>"
                               placeholder="è¯·è¾“å…¥å®¢æˆ·é’ˆå¯¹è¯¥é¡¹ç›®çš„è¯„ä»·"
                               autocomplete="on" class="layui-input" id="project_comment">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" for="project_commentFrom">è¯„ä»·å®¢æˆ·</label>
                    <div class="layui-input-block">
                        <input type="text" value="<%= project && project.commentFrom %>"
                               placeholder="è¯·è¾“å…¥å¯¹è¯¥æ¡ˆä¾‹è¿›è¡Œè¯„ä»·çš„å®¢æˆ·"
                               autocomplete="on" class="layui-input" id="project_commentFrom">
                    </div>
                </div>

                <div class="layui-form-item mt-30 pb-30">
                    <div class="layui-input-block">
                        <button class="layui-btn" type="button" id="save_project">ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	$(document).ready(function () {
		layer.config({
			title: 'æç¤º'
		})

		layui.use('form', function () {
			var form = layui.form;
		})

		$("#save_project").bind('click', function () {
			var project_id = $('#project_id').val();
			var project_title = $('#project_title').val();
			var project_imgUrl = $('#project_imgUrl').val();
			var project_company = $('#project_company').val();
			var project_comment = $('#project_comment').val();
			var project_linkUrl = $('#project_linkUrl').val();
			var project_commentFrom = $('#project_commentFrom').val();
			var project_category = $("input[name='project_category']:checked").val();
			if (!(project_title.trim() && project_imgUrl.trim()
					&& project_company.trim() && project_category.trim())) {
				layer.msg("æ¡ˆä¾‹ä¿¡æ¯ä¸èƒ½ä¸ºç©ºå“¦ğŸ˜¯!");
				return;
			}

			$.ajax({
				type: 'POST',
				url: '/admin/project/save',
				data: {
					projectId: project_id,
					title: project_title,
					imgUrl: project_imgUrl,
					company: project_company,
					comment: project_comment,
					linkUrl: project_linkUrl,
					commentFrom: project_commentFrom,
					category: project_category
				}
			}).done(function (res) {
				if (res.success === 1) {
					layer.msg("æ¡ˆä¾‹ä¿å­˜æˆåŠŸ!")
					location.replace('/admin/projectList')
				}
			})

		})
	})
</script>
</body>